<!DOCTYPE html>
<!-- saved from url=(0061)http://fecore.net.ua/javascript/pages/theory/module-07-2.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>Module 7</title><link rel="stylesheet" href="./Module 7-2_files/styles.min.css"><script async="" src="./Module 7-2_files/scripts.min.js.Без названия"></script></head><body class="theory-page"><div class="wrapper"><article><header><nav class="table-of-contents" id="main-nav"><ol class="page-nav" id="page-nav"><li><a href="http://fecore.net.ua/javascript/pages/theory/module-07-2.html#bom">BOM</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-07-2.html#url">Структруа URL-строки</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-07-2.html#history-location">History и Location</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-07-2.html#geolocation">Геолокация</a></li></ol></nav></header><section><h2 id="bom">BOM</h2><p>Сам по себе JavaScript не предусматривает работы с браузером, он вообще не знает про HTML, но позволяет легко расширять себя новым функционалом.</p><p>На рисунке ниже схематически изоабражена структура, которая получается если посмотреть на совокупность браузерных объектов.</p><img src="./Module 7-2_files/dom-bom.jpg" alt="dom-bom"><p>Над всем стоит <code>window</code>, он является глобальным объектом в JavaScript, и содержит свойства и методы для управления окном браузера.</p><p>Далее мы видим глобальный объект <code>document</code>, он позволяет взаимодействовать с содержимым страницы.</p><p>И конечно <code>JavaScript Core</code> - браузерная реализация JavaScript.</p><p><strong>Объектная модель браузера (Browser Object Model)</strong> - позволяет JavaScript взаимодействовать с браузером, предоставляет объекты, через свойства и методы которых можно получить доступ к окну текущей странице и ряду функций браузера.</p><h3>Объект navigator</h3><p>Содержит информацию о браузере и операционной системе, в которой браузер запущен. Он определяет ряд свойств и методов, основным из которых является свойство <code>userAgent</code>, представляющее браузер пользователя.</p><pre class=" language-javascript"><code class=" language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Данное свойство хранит полную строку юзер-агента, например:</p><pre class=" language-javascript"><code class=" language-javascript">Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>Windows NT <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span> AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span>KHTML<span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> Chrome<span class="token operator">/</span><span class="token number">65.0</span><span class="token punctuation">.</span><span class="token number">3325.181</span> Safari<span class="token operator">/</span><span class="token number">537.36</span></code></pre><h3>Объект screen</h3><p>Информационный объект. Хотя он и является свойством объекта <code>window</code>, но никакого отношения к окну браузера не имеет. Он дает информацию о экране пользователя.</p><pre class=" language-javascript"><code class=" language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>screen<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ...</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ...</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ...</span></code></pre><h3>Feature Detection</h3><p><strong>Обнаружение возможностей браузера</strong> - это всего лишь способ определить, существует ли функция в определенных браузерах, так как не все браузеры поддерживаю все возможости <strong>BOM</strong>.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token comment">// Проверяем если ли navigator в window</span>
<span class="token keyword keyword-if">if</span><span class="token punctuation">(</span><span class="token string">"navigator"</span> <span class="token keyword keyword-in">in</span> window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'navigator на месте!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Проверяем есть ли в объекте navigator свойство geolocation</span>
<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Если есть, выполняем код</span>
<span class="token punctuation">}</span></code></pre><ul><li><a href="https://developer.mozilla.org/en-US/docs/Learn/Tools_and_testing/Cross_browser_testing/Feature_detection" target="_blank">Implementing feature detection</a></li><li><a href="https://medium.com/@rlynjb/js-interview-question-what-s-the-difference-between-feature-detection-feature-inference-and-76d2e4956a9b" target="_blank">What’s the difference between feature detection, feature inference, and using the UA string?</a></li><li><a href="https://modernizr.com/" target="_blank">Modernizr</a></li></ul></section><section><h2 id="url">Структруа URL-строки</h2><p>Отличающее преимущество веб-приложения от десктоп-приложения это наличие URL, при переходе по которому, пользователь оказывается в определенной части приложения. Таким образом можно сохранить закладку или передать ссылку другому пользователю, при этом ему будет отображен один и тот же интерфейс (за исключением авторизации).</p><p>Аналогией URL-строки может быть адрес по которому вы проживаете: улица, дом, квартира. Таким образом у каждого состояния нашего интерфейса есть свой адрес, свой URL.</p><img src="./Module 7-2_files/url-string.jpg" alt="url-string"><ul><li><strong>https://</strong> — протокол</li><li><strong>mysite.com/</strong> — хост</li><li><strong>books/e3q76gm9lzk</strong> — путь, то где мы находимся в приложении</li><li><strong>e3q76gm9lzk</strong> — url-параметр. Параметры бывают динамическими или статическими</li><li><strong>?</strong> — символ начала строки запроса</li><li><strong>?category=adventure&amp;status=unread</strong> — строка запроса</li><li><strong>category=adventure</strong> — пара параметр=значение</li><li><strong>&amp;</strong> — символ "И", разделяет параметры строки запроса</li><li><strong>#comments</strong> — якорь, определяет положение на странице</li></ul></section><section><h2 id="history-location">History и Location</h2><p>В браузере, в глобальном объекте <code>window</code> хранятся данные о местоположении (информация о URL-адресе) и истории сеансов (стек местоположений посещенных текущей вкладкой браузера). Они доступны через:</p><ul><li><code>window.location</code> - <a href="https://developer.mozilla.org/en-US/docs/Web/API/Location" target="_blank" rel="noopener">Location API</a></li><li><code>window.history</code> - <a href="https://developer.mozilla.org/en-US/docs/Web/API/History" target="_blank" rel="noopener">History API</a></li></ul><h3>История браузера. Объект history</h3><p>Содержит информацию о всех ресурсах, к которым обращался пользователь за время текущего сеанса. Все сведения о посещении пользователя хранятся в специальном стеке <strong>history stack</strong>.</p><ul><li><code>history.next</code> - следующая страница</li><li><code>history.previous</code> - предыдущая страница</li><li><code>history.current</code> - текущая страница</li></ul><p>Для перемещения по страницам в истории в объекте <strong>history</strong> определены методы навигации по истории, отличающиеся возможностью обновлять историю и местоположение браузера без необходимости перезагрузки страницы.</p><ul><li><code>pushState(path)</code> — добавляет новое место в стек истории</li><li><code>replaceState(path)</code> — перезаписывает текущее местоположение в стеке истории на новое</li><li><code>back()</code> — переход в предыдущее место в стеке истории</li><li><code>forward()</code> — переход к следующему месту в стеке истории</li><li><code>go(index)</code> — перемещается на определенное число страниц в стеке истории. Отрицательное значение указывает назад, положительное вперед</li></ul><p>С помощью свойства <code>length</code> можно узнат сколько станиц хранится в стеке.</p><h3>Текущее местоположение. Объект location</h3><p>Содержит свойства описывающие местонахождение текущего документа, например url-адрес.</p><ul><li><code>href</code> - полная строка запроса к ресурсу</li><li><code>pathname</code> - путь к ресурсу</li><li><code>origin</code> - общая схема запроса</li><li><code>protocol</code> - протокол</li><li><code>port</code> - порт, используемый ресурсом</li><li><code>host</code> - хост</li><li><code>hostname</code> - название хоста</li><li><code>hash</code> - если строка запроса содержит символ решетки (#), то данное свойство возвращает ту часть строки, которая идет после этого символа</li><li><code>search</code> - если строка запроса содержит знак вопроса (?), например, то данное свойство возвращает ту часть строки, которая идет после знака вопроса</li></ul><p>Также объект <strong>location</strong> предоставляет ряд методов, которые можно использовать для управления путем.</p><ul><li><code>assign(url)</code> - загружает ресурс, который находится по пути url</li><li><code>replace(url)</code> - заменяет текущую веб-станицу другим ресурсом, который находится по пути url. В отличие от метода assign, который также загружает веб-станицу с другого ресурса, метод replace не сохраняет предыдущую веб-страницу в стеке истории переходов history, поэтому мы не сможем вызвать метод history.back() для перехода к ней.</li></ul><p>Для перенаправления на другой ресурс мы можем использовать как свойства, так и методы location:</p><pre class=" language-javascript"><code class=" language-javascript">location <span class="token operator">=</span> <span class="token string">"https://google.com"</span><span class="token punctuation">;</span>
<span class="token comment">// аналогично</span>
<span class="token comment">// location.href = "https://google.com";</span>
<span class="token comment">// location.assign("https://google.com");</span></code></pre><p>Переход на другой локальный ресурс:</p><pre class=" language-javascript"><code class=" language-javascript">location<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Вместе API истории и местоположения позволяют использовать современную клиентскую маршрутизацию маршрутизации, известную как <strong>pushState routing</strong>.</p><p>Для управления историей и местоположением используется современная библиотека <a href="https://github.com/ReactTraining/history" target="_blank" rel="noopener">history</a>. Она предоставляет простой, но мощный API для взаимодействия с историей и местоположением браузера, в то же время скрывая несоответствия между различными реализациями браузеров. Используется как внутренняя зависимость во многих современных библиотеках маршрутизации.</p></section><section><h2 id="geolocation">Геолокация</h2><p>Геолокация – определение географического положения пользователя с помощью разнообразных механизмов сбора данных. Как правило, для определения местоположения большинство служб геолокации используют адреса сетевой маршрутизации или внутренние устройства GPS. Геолокация является API, зависящим от устройства. Это означает, что браузеры или устройства должны поддерживать геолокацию, чтобы использовать её в веб-приложениях.</p><p>Объект <code>navigator</code> хранит свойство <code>geolocation</code>, с помощью которого можно получить географическое положение пользователя. Для получения положения используется метод <code>getCurrentPosition</code>.</p><p>Этот метод принимает два параметра:</p><ul><li><code>onSuccess</code> - функция которая срабатывает при удачном запуске геолокации.</li><li><code>onError</code> - функция которая срабатывает при ошибке запроса геоданных.</li></ul><pre class=" language-javascript"><code class=" language-javascript">navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span>onSuccess<span class="token punctuation">,</span> onError<span class="token punctuation">)</span></code></pre><p>В функцию, которая выполняется при удачном определении геоданных, передается позиция пользователя в виде параметра <a href="https://developer.mozilla.org/en-US/docs/Web/API/Position" target="_blank"><code>position</code> </a>. Передаваемый объект имеет вложенный объект <code>coords</code>, с помощью свойство которого можно получить непосредственные координаты пользователя, и свойство <code>timestamp</code>, хранящее временную метку.</p><ul><li><code>latitude</code> - географическая широта</li><li><code>longitude</code> - географическая долгота</li><li><code>altitude</code> - высота</li><li><code>speed</code> - скорость, с которой перемещается пользователь</li><li><code>heading</code> - направление движения</li><li><code>accuracy</code> - точность опредения позиции</li></ul><p>При этом надо учитывать, что в браузерах действует политика безопасности, которая при обращении к методу <code>geolocation.getCurrentPosition()</code> отображает пользователю сообщение, в котором пользователь может подтвердить отправку географических координат. Если же пользователь откажется, то будет срабатывать функция <code>onError()</code>.</p><p>В функцию <code>onError</code> передается параметр <a href="https://developer.mozilla.org/en-US/docs/Web/API/PositionError" target="_blank"><code>positionError</code> </a>, содержащий информацию о ошибке.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword keyword-const">const</span> <span class="token function-variable function">onSuccess</span> <span class="token operator">=</span> position <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> latitude<span class="token punctuation">,</span> longitude <span class="token punctuation">}</span> <span class="token operator">=</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Широта: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>latitude<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, Долгота: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>longitude<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> <span class="token function-variable function">onError</span> <span class="token operator">=</span> error <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Ошибка при определении положения: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>

navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span>onSuccess<span class="token punctuation">,</span> onError<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a href="https://www.tutorialspoint.com/html5/html5_geolocation.htm" target="_blank"><strong>HTML5 - Geolocation</strong></a></p></section></article><a href="http://fecore.net.ua/javascript/pages/theory/module-07-2.html#main-nav" class="to-page-nav"></a></div></body></html>