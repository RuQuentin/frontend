<!DOCTYPE html>
<!-- saved from url=(0061)http://fecore.net.ua/javascript/pages/theory/module-11-1.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>Module 11</title><link rel="stylesheet" href="./Module 11_files/styles.min.css"><script async="" src="./Module 11_files/ei.js.Без названия"></script><script async="" src="./Module 11_files/scripts.min.js.Без названия"></script></head><body class="theory-page"><div class="wrapper"><article><header><nav class="table-of-contents" id="main-nav"><ol class="page-nav" id="page-nav"><li><a href="http://fecore.net.ua/javascript/pages/theory/module-11-1.html#intro">Шаблонизация</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-11-1.html#usage">Использование шаблонизации</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-11-1.html#gallery">Галлерея на шаблонах</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-11-1.html#resources">Дополнительные материалы</a></li></ol></nav></header><section><h2 id="intro">Шаблонизация</h2><p><strong>Шаблонизация (Templating)</strong> – это метод связывания данных на стороне клиента. Удобный способ генерации HTML-разметки по «шаблону» и данным. Этот подход стал популярным благодаря расширению использования JavaScript, увеличению возможностей обработки клиентских данных и тенденциям аутсорсинга вычислений в веб-браузере клиента.</p><p>Суть шаблонизации заключается в том, чтобы отделить разметку страницы от программного кода. Разметка помещается в отдельные файлы (шаблоны), в местах, где необходимо вывести данные размещаются специальные псевдопеременные. Сценарий загружает нужный шаблон и заменяет в нем псевдопеременные на соответствующие данные.</p><h3>Когда стоит использовать шаблонизацию?</h3><p>Некоторые случаи использования шаблонов - это веб-приложения (например, интернет-магазин где текущий список товаров зависит от выбраных пользователем опций поиска), а так же любые другие ситуации которые требуют отображения другого контента с использованием того же форматирования.</p><p>Разделение представления и логики имеет первостепенное значение при создании поддерживаемой кодовой базы, поэтому необходимо изучить все, что может помочь вам в достижении этого. В интерфейсной веб-разработке это воплощается при помощи отделения HTML от JavaScript.</p><p>Большинство компонентов (элементов интерфейса), получают готовый HTML/DOM и «оживляют» его. Это типичный случай на сайтах, где разметка и CSS уже есть, от JavaScript, условно говоря, требуются лишь обработчики, чтобы элементы интерфейса заработали. Но в сложных интерфейсах разметка изначально отсутствует на странице. Компоненты генерируют DOM сами, динамически, на основе данных, полученных с сервера или из других источников.</p><p>Плюсы:</p><ul><li>поддерживаемость кода</li><li>читабельность кода</li><li>легко вносить правки</li><li>улучшает организационную часть, выделяем представление в отдельный слой</li></ul></section><section><h2 id="usage">Использование шаблонизации</h2><p>Весь процесс требует нескольких простых шагов. Наличие данных ( <code>data</code>) которыми будет наполнятся элемент интерфейса. Шаблон ( <code>template</code>) по которому будет составлена разметка элемента, и конечно библиотека которая предоставляет средства шаблонизации ( <code>template engine</code>). В результате мы получим HTML разметку.</p><img src="./Module 11_files/templating.png" alt="templating"><p>Мы подробно рассмотрим это на конкретных примерах, но по сути это это очень просто:</p><ol><li>Подключить в проект выбраную библиотеку для шаблонизации</li><li>Составить HTML шаблон необходимого вида</li><li>Сделать выборку нашего шаблона в скрипте</li><li>Произвести рендеринг шаблона вместе с данными</li></ol><h3>Шаблон</h3><p>Синтаксис шаблона варъируется от библиотеки к библиотеке, самое важное это понимать принцип работы шаблонизаторов. Мы будем использовать шаблонизацию предоставляемую библиотекой <a href="https://handlebarsjs.com/" target="_blank">Handlebars</a>.</p><p><strong>Шаблон</strong> – это строка в специальном формате, которая путём подстановки значений и выполнения встроенных фрагментов кода превращается в HTML. Как видно, это обычный HTML, с вставками вида <code>{{...}}</code>, это синтаксис Handlebars-шаблона.</p><pre class=" language-markup"><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu-title<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    {{#each items}}
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{this}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    {{/each}}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre><h3>Синтаксис шаблона</h3><p>Шаблон представляет собой строку со специальными разделителями, которых в <code>Hanelbars</code> всего два</p><ul><li><code>{{expr}}</code> – expr между разделителями будет выполнен «как есть», то есть вместо имени переменной будет подставлено ее значение, при этом если переменная содержит строку с тегами, то не произойдет парса строки.</li><li><code>{{{expr}}}</code> – используется для вставки html-тегов, если <code>expr = '&lt;p&gt;text&lt;/p&gt;'</code> то вставится именно тег абзаца.</li><li><code>{{#helper}}{{/helper}}</code> - используется для <a href="https://handlebarsjs.com/builtin_helpers.html" target="_blank" rel="noopener">встроенных и кастомных операций</a>, к примеру <code>each</code> работает как <code>forEach</code>, перебирая коллекцию, а в теле <code>each</code> к элементу коллекции можно обратиться как <code>this</code>.</li></ul><h3>Методы хранения шаблона</h3><p>Шаблон это просто многострочный HTML-текст, значит ему не место в файле скриптов. Где же хранят шаблоны? Один из способов хранения шаблона - записать его в HTML файле, в тег <code>template</code>.</p><p>Большинство библиотек поддерживают как встроенные, так и внешние шаблоны. Встроенные шаблоны подходят, когда у нас очень мало шаблонов, или мы знаем, что мы будем использовать включенные шаблоны при загрузке каждой страницы, но обычно наши шаблоны должны быть внешними.</p><p>Внешние шаблоны имеют много преимуществ, главным образом в том, что шаблоны никогда не будут загружаться клиенту, если они не нужны на странице. В этом модуле мы будем пользоваться встроенными шаблонами, для использования внешних шаблонов необходимы дополнительные инструменты, с ними мы познакомимся дальше в курсе.</p><p>Давайте обернем наш шаблон в тег <code>template</code>.</p><pre class=" language-markup"><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu-title<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      {{#each items}}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>menu-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{this}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      {{/each}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></code></pre><h3>Использование шаблона</h3><p>Вернемся к перечисленым шагам, где мы описали последовательность действий необходимых для использования шаблонизации, и по пунктам разберем шаги которые нам необходимо предпринять.</p><h4>Добавить в проект бибилиотеку</h4><p>Подключение библиотеки в проект происходит очень просто. Есть несколько вариантов. Первый, это скачать файл библиотеки и подключить его в <code>index.html</code>. Второй, использовать CDN сервис для получения ссыки на файл библиотеки. Также можно ставить библиотеку как npm-пакет, с этим способом мы познакомимся дальше в курсе. В данном уроке для нас нет особой разницы, возьмем второй вариант.</p><p>Используем средства шаблонизации библиотеки <code>Handlebars</code>. В разделе документации <a href="https://handlebarsjs.com/installation.html" target="_blank" rel="noopener">о установке</a> библиотеки, есть ссылка на CDN сервис на котором можно скопировать необходимую ссылку.</p><pre class=" language-javascript"><code class=" language-javascript">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>cdnjs<span class="token punctuation">.</span>cloudflare<span class="token punctuation">.</span>com<span class="token operator">/</span>ajax<span class="token operator">/</span>libs<span class="token operator">/</span>handlebars<span class="token punctuation">.</span>js<span class="token operator">/</span><span class="token number">4.0</span><span class="token punctuation">.</span><span class="token number">11</span><span class="token operator">/</span>handlebars<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js</code></pre><p>Это минифицированая версия библиотеки. Все что нам нужно сделать это в <code>index.html</code>, перед закрывающим тегом <code>body</code> и перед нашим файлом скриптов, добавить еще один тег <code>script</code>.</p><pre class=" language-markup"><code class=" language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></code></pre><h4>Составить HTML шаблон необходимого вида</h4><p>Этот шаг мы выполнили выше. У нас уже есть полностью готовый шаблон для меню. Добавим его перед всеми скриптами в документе.</p><h4>Сделать выборку шаблона в скрипте</h4><p><code>script</code> это тег, по сути ничем не отличающийся от того-же <code>div</code>. Значит мы можем выбрать этот тег по селектору тега/класса/идентификатора. Хорошей практикой считается давать тегам <code>script</code>, содержащим шаблон, уникальные идентификаторы. Тогда мы можем гарантировать выборку именно того шаблона который нам необходим.</p><p>Теперь в <code>.js</code> файле мы можем по <code>id</code> выбрать сам тег <code>script</code> с <code>id="menu"</code>. Следующим шагом нас интересует текстовый контент внутри тега. Мы уже знаем что текстовый контент тега можно выбрать используя свойство <code>innerHTML</code>.</p><div class="cp_embed_wrapper"><iframe id="cp_embed_OjKGoy" src="./Module 11_files/OjKGoy.html" scrolling="no" frameborder="0" height="201" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" name="CodePen Embed" title="module-09-tmpl-selection" class="cp_embed_iframe " style="width: 100%; overflow: hidden;"></iframe></div><h4>Произвести рендеринг шаблона с данными</h4><p>У нас уже есть подключеная библиотека и готовый шаблон из которого мы так-же изъяли текстовый контент. Для работы с шаблоном в библиотеке Handlebars есть функция <code>compile</code>. Эта функция запускает «компиляцию» шаблона <code>source</code> и возвращает результат в виде функции, которую далее можно запустить с данными и получить строку-результат.</p><pre class=" language-javascript"><code class=" language-javascript">Handlebars<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span></code></pre><p>Вызов <code>Handlebars.compile(source)</code> разбивает html-строку по разделителям и, при помощи <code>new Function</code> создаёт на её основе JavaScript-функцию. Тело этой функции создаётся таким образом, что код, который в шаблоне оформлен как <code>{{...}}</code> – попадает в неё «как есть», а переменные и текст прибавляются к специальному временному «буферу», который в итоге возвращается.</p><img src="./Module 11_files/1435920536how-handlebars-works.png" alt=""><div class="cp_embed_wrapper"><iframe id="cp_embed_zdgXmj" src="./Module 11_files/zdgXmj.html" scrolling="no" frameborder="0" height="250" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" name="CodePen Embed" title="module-09-tmpl-compile" class="cp_embed_iframe " style="width: 100%; overflow: hidden;"></iframe></div><p>Теперь используя функцию-шаблон <code>template</code> мы можем передать ей данные как аргумент и она вернет нам <code>html-строку</code>.</p><p>Для начала добавим данные для нашего списка. В шаблоне указана какая-то переменная <code>title</code> и <code>items</code>. Конечно в реальных задачах сначала создаются форматы для данных, а потом под них пишутся шаблоны, но для наглядности мы для шаблона напишем данные.</p><p>Данные для шаблона это что угодно, строка, обьект, массив итд, зависит от задачи, чаще всего обьект или массив обьектов. Так как у нас список с заголовком и набором пунктов, нам удобно использовать обьект такого вида.</p><p>Следующим шагом будет вызвать нашу функцию-шаблон и передать ей <code>menuData</code> как аргумент. Дальше мы можем эту строку поместить в html тег и браузер, распарсив ее, создаст html разметку.</p><div class="cp_embed_wrapper"><iframe id="cp_embed_WEVWPR" src="./Module 11_files/WEVWPR.html" scrolling="no" frameborder="0" height="400" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" name="CodePen Embed" title="module-09-tmpl-render" class="cp_embed_iframe " style="width: 100%; overflow: hidden;"></iframe></div><h4>Чем же хорош данный подход?</h4><ul><li>Поддерживаемость кода</li><li>Читабельность кода</li><li>Легко вносить правки</li><li>Улучшает организационную часть, выделяем представление в отдельный слой</li></ul><p>Представьте что данные для этого списка приходят с сервера, мало того, они меняются каждую минуту. Используя шаблонизацию мы можем получать данные, не важно сколько пунктов списка, и передавать их в функцию-шаблон. В результате у нас получается динамически создающийся список не зависимо от кол-ва пунктов.</p><p>Представьте список статей на веб странице. Данные для статей приходят от сервера, как массив обьектов, у нас есть шаблон одной статьи. Используя цикл мы можем пройтись по массиву обьектов и вызвать функцию-шаблон для каждого обьекта, результатом будет строка с подставлеными данными. После чего мы в контейнер для статей просто "повесим" строку и браузер создаст разметку.</p><p>Это стандартный подход написания динамических элементов интерфейса, данные для которых изменяются со временем.</p></section><section><h2 id="gallery">Галлерея на шаблонах</h2><p>Давайте создадим галлерею изображений. Каждый элемент галлереи будет картинкой с текстом-описанием по центру.</p><div class="cp_embed_wrapper"><iframe id="cp_embed_OxLVZg" src="./Module 11_files/OxLVZg.html" scrolling="no" frameborder="0" height="500" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" name="CodePen Embed" title="module-09-practice" class="cp_embed_iframe " style="width: 100%; overflow: hidden;"></iframe></div></section><section><h2 id="resources">Дополнительные материалы</h2><ul><li><a href="https://tutorialzine.com/2015/01/learn-handlebars-in-10-minutes" target="_blank">Learn Handlebars in 10 Minutes or Less</a></li><li><a href="https://www.sitepoint.com/a-beginners-guide-to-handlebars/" target="_blank">A Beginner’s Guide to Handlebars</a></li><li><a href="https://goo.gl/EaSukK" target="_blank">Правильная шаблонизация</a></li><li><a href="https://pugjs.org/api/getting-started.html" target="_blank">PUG</a></li></ul></section></article><a href="http://fecore.net.ua/javascript/pages/theory/module-11-1.html#main-nav" class="to-page-nav"></a></div></body></html>