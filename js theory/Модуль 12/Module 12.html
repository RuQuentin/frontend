<!DOCTYPE html>
<!-- saved from url=(0061)http://fecore.net.ua/javascript/pages/theory/module-12-1.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>Module 12</title><link rel="stylesheet" href="./Module 12_files/styles.min.css"><script async="" src="./Module 12_files/scripts.min.js.Без названия"></script></head><body class="theory-page"><div class="wrapper"><article><header><nav class="table-of-contents" id="main-nav"><ol class="page-nav" id="page-nav"><li><a href="http://fecore.net.ua/javascript/pages/theory/module-12-1.html#node">Введение в Node.js</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-12-1.html#npm">Пакетный менеджер npm</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-12-1.html#gulp">Gulp</a></li></ol></nav></header><section><h2 id="node">Введение в Node.js</h2><p><strong>Node.js</strong> - легкая и эффективная среда выполнения JavaScript, построенная на движке <code>V8</code>. Позволяет писать высокопроизводительные серверы с помощью JavaScript. Использует тот же движок V8 Javascript, который встроен в браузер Google Chrome.</p><ul><li>Позволяет иметь общий код на клиенте и на сервере</li><li>Уверенно поддерживает множество соединений одновременно</li><li>Легко сделать прототип приложения</li><li>Менеджер пакетов <code>npm</code> c огромным набором готовых решений</li></ul><h3>Установка</h3><p>Чтобы установить последнюю версию <strong>Node</strong>, перейдите на <a href="https://nodejs.org/en/" target="_blank">официальную страницу </a>. Скачайте инсталятор и следуйте указаниям, достаточно просто нажимать <strong>Next</strong>.</p><p>С момента создания Node.js, есть план релиза: стабильный и экспериментальный. В Node.js стабильные версии с долгосрочной поддержкой обозначаются как <strong>LTS</strong>. В разработке рекомендуется использовать LTS-версию.</p><p>Когда Node.js установится, вы можете использовать команду <code>node</code> в консоли:</p><pre class=" language-javascript"><code class=" language-javascript">node <span class="token operator">--</span>version</code></pre><figure><img src="./Module 12_files/node-ver.png" alt="node version"><figcaption>Версия Node.js на момент написания данного модуля</figcaption></figure><p>Если в будущем вы захотите добавить больше версий Node.js, то нужно использовать <strong>nvm</strong> (Node Version Manager).</p><ul><li><a href="https://github.com/creationix/nvm" target="_blank">Для Mac/Linux</a></li><li><a href="https://github.com/coreybutler/nvm-windows" target="_blank">Для Windows</a></li></ul><h3>Основы Node.js</h3><p>Давайте попробуем использовать Node.js в терминале. Откройте любой терминал, к пример GitBash и выполните команду <code>node</code>. Теперь с новой строки можно выполнять JavaScript код. Выведем что-то в консоль.</p><figure><img src="./Module 12_files/node-log.png" alt="node log"><figcaption>Итак, в ноде можно выполнять JavaScript код</figcaption></figure><p>Сделаем следующий шаг, давайте начнем с создания файла под названием <code>index.js</code>. Откройте ваш редактор кода, создайте новый файл и сохраните его как <code>index.js</code>, внутрь поместите код из предыдущего шага: <code>console.log('Node.js is amazing!');</code>.</p><p>Для того, чтобы запустить его, вам нужно снова открыть свой терминал и перейти в директорию, в которой вы разместили <code>index.js</code>. После того как вы успешно это сделали, запустите файл с помощью команды <code>node index.js</code>. Вы увидите, что получится тот же результат, как и раньше - вывод строки непосредственно в терминале.</p><figure><img src="./Module 12_files/node-run.png" alt="node run"><figcaption>Мы узнали что Node.js может запускать файлы скриптов на исполнение</figcaption></figure><p>В этом и заключается суть Node.js, среда позволяет выполнять JavaScript вне браузера. Таким образом мы можем писать целые приложения, к примеру бекенд сервисы, которые не зависят от браузера.</p></section><section><h2 id="npm">Пакетный менеджер npm</h2><p><strong>NPM (node package manager)</strong> - это менеджер пакетов, который используется Node.js приложениями, вы можете найти там тысячи модулей. NPM идет в комплекте с Node.js. Есть два основных интерфейса с которыми вы будете работать - <a href="https://npmjs.com/" target="_blank">сайт NPM (npmjs.com)</a>, и командная строка NPM, оба используют однин и тотже рестр для поиска модулей.</p><h3>Инициализация</h3><p>Каждый Node.js проект начинается с создания файла <code>package.json</code> - вы можете думать об нем как о JSON-представлении приложения и его зависимостей. Он содержит название вашего приложения, автора и список зависимостей.</p><p>Вы можете интерактивно создать файл <code>package.json</code> с помощью команды <code>npm init</code> в терминале. Вам будет предложено ввести название вашего проекта, версию, описание и т.д. Не беспокойтесь, просто нажимайте <code>enter</code>, пока вы не получите JSON-сниппет и вопрос <code>is this ok ?</code>. Нажмите <code>enter</code> еще один раз и вуаля, <code>package.json</code> был автоматически сгенерирован и размещен в папке вашего проекта.</p><img src="./Module 12_files/npm-init.png" alt="npm init"><p>Чтобы не нажимать <code>enter</code> пропуская пустые поля, можно использовать <code>npm init</code> с флагом <code>--yes</code>. Если вы используете <code>npm init --yes</code>, он ничего не потребует, просто создаст <code>package.json</code> со значениями по умолчанию. Чтобы установить эти значения по умолчанию, вы можете использовать следующие команды:</p><pre class=" language-javascript"><code class=" language-javascript">npm config <span class="token keyword keyword-set">set</span> init<span class="token punctuation">.</span>author<span class="token punctuation">.</span>name YOUR_NAME
npm config <span class="token keyword keyword-set">set</span> init<span class="token punctuation">.</span>author<span class="token punctuation">.</span>email YOUR_EMAIL</code></pre><p>Если открыть <code>package.json</code> в редакторе кода, он будет выглядеть примерно так:</p><img src="./Module 12_files/package.png" alt="package"><p>Вы можете отредактировать файл <code>package.json</code> вручную или запустив еще раз <code>npm init</code>.</p><h3>NPM скрипты</h3><p><strong>NPM скрипты</strong> - это мощная концепция, с их помощью можно разрабатывать небольшие утилиты или даже создавать сложные системы разработки.</p><p>Наиболее распространенными из них являются скрипты <code>start</code> и <code>test</code>. Через <code>start</code> вы можете определить, как ваше приложение будет запускаться, а <code>test</code> используется для запуска тестов. Давайте автоматизируем запуск <code>index.js</code>. Добавим скрипт запуска <code>start</code> для нашего <code>package.json</code>, как показано в примере.</p><img src="./Module 12_files/npm-script.png" alt="script"><p>Как только вы сделаете это, вы сможете запускать приложение командой <code>npm start</code>.</p><img src="./Module 12_files/npm-start.png" alt="script"><p>Если вы создадите скрипт с любым другим кастомным именем, кроме <code>start</code> или <code>test</code>, он будет запускаться как <code>npm run имя-вашего-скрипта</code> - не забудьте <code>run</code>.</p><p><a href="https://docs.npmjs.com/misc/scripts" target="_blank" rel="noopener"><strong>How npm handles the "scripts" field</strong></a></p><h3>Добавление зависимостей</h3><p>Одна из самых важных возможностей, которые предоставляет npm, - это установка пакетов. Зависимости извлекаются из реестра и распаковываются в папку <code>node_modules</code>.</p><p>После того, как в вы создали файл <code>package.json</code>, вы можете добавить зависимости к вашему приложению. Зависимостью называют npm-пакет который используется при разаботке приложения. Это всевозможные утилиты и библиотеки.</p><ul><li><a href="https://docs.npmjs.com/cli/install" target="_blank"><code>npm install имя-пакета</code> </a>(или <code>npm i имя-пакета</code>) - запускает процесс установки модуля в проект.</li><li><a href="https://docs.npmjs.com/cli/uninstall" target="_blank"><code>npm uninstall имя-пакета</code> </a>(или <code>npm rm имя-пакета</code>) - запускает процесс удаления модуля из проекта.</li></ul><p>Установим пакет <code>uuid</code> для генерации уникальных идентификаторов.</p><img src="./Module 12_files/npm-i.png" alt="install"><p>С помощью этой команды мы загрузили <code>uuid</code> и поместили его в папку <code>node_modules</code>. Это папка, в которой будут находиться все ваши внешние зависимости.</p><div class="warn"><p>Не добавляйте папку <code>node_modules</code> в систему контроля версий, так что если вы используете Git, не забывайте добавить ее в файл <code>.gitignore</code>.</p></div><hr><p>При разработке веб-приложений, вам нужно будет минимизировать JavaScript файлы, сжимать картинки и тому подобное. Модули, которые будут делать это необходимы только при разработке. Для этого в <code>npm</code> существуют 2 флага.</p><ul><li><code>--save</code> - говорит npm о том что мы ставим зависимость продакшена. Пакет будет помещен в dependencies.</li><li><code>--save-dev</code> - говорит npm о том что мы ставим зависимость разработки. Появится новый раздел в вашем файле <code>package.json</code> под названием <code>devDependencies</code>. Все модули, которые вы установили через <code>--save-dev</code> будут описаны именно там. Они также будут размещены в директории <code>node_modules</code>.</li></ul><p><code>npm</code> предназначен не только для установки пакетов. Он также может показать вам уже установленые зависимости проекта, используя команду <code>npm ls</code>. Запустите эту команду в рабочей директории. Если есть проблемы с пакетами, то <code>npm</code> предупредит вас, показывая сообщение об ошибке <code>!ERR</code>.</p><hr><p>Теперь посмотрим в файл <code>package.json</code>. Появилась новая зависимость в поле dependencies. Это означает, что <code>uuid</code> версии <code>3.1.0</code> был установлен как зависимость продакшена и готов к работе.</p><figure><img src="./Module 12_files/npm-dep.png" alt="dep"><figcaption>npm модули постоянно обновляются, версия которую установите Вы может отличаться</figcaption></figure><p><code>uuid</code> готов к использованию, давайте попробуем. Вы можете сделать это используя функцию <code>require</code>, аргументом передав ей имя модуля, без определения пути. Путь не нужен, так как по умолчанию поиск модуля будет происходить в папке <code>node_modules</code>.</p><p>NodeJS использует собственный вариант работы с модулями, называемый <code>CommonJS</code>, он не работает в браузере.</p><img src="./Module 12_files/using-module.png" alt="usage"><p>Выполнив в консоли <code>npm start</code> получим:</p><img src="./Module 12_files/uuid-res.png" alt="uuid"><h3>Управление версиями пакетов</h3><p>Каждый пакет в npm имеет номер версии, связанный с ним. Когда выходят обновления пакета, они получают номер версии пакета.</p><p>Номера версий в npm соответствуют стандарту <code>«SemVer»</code>. Спецификацию этого стандарта можно посмотреть на <a href="http://semver.org/" target="_blank">http://semver.org</a>.</p><p>На примере разберем установленый пакет <code>uuid</code>, он имеет версию <code>3.1.0</code>, версия состоит из 3-х составляющих:</p><table><tbody><tr><th>Составляющая</th><th>Значение</th></tr><tr><td>0</td><td>Патч версия. Обновление для каждого изменения.</td></tr><tr><td>1</td><td>Незначительная версия. Обновление для дополнений API.</td></tr><tr><td>3</td><td>Основная версия. Обновление для изменения API.</td></tr></tbody></table><h4>Версии</h4><p>npm имеет специальную команду <code>npm version</code>, которая обновит ваш <code>package.json</code>, а также зафиксирует изменение в <code>git</code>, если проект связан с <code>git</code> репозиторием. Вы можете узнать больше выполнив <code>npm help version</code>.</p><div class="note"><p>Если вы не доверяете машинам 🤖, можете открыть свой <code>package.json</code> файл вручную, и поменяйть версии пакетов, после чего выполнить <code>npm i</code>.</p></div><p>Теперь, когда у нас есть некоторые зависимости и мы умеем читать их версии, очевидный вопрос: что делать, как узнать что пакеты обновились?</p><p>Так как версии пакетов определяются диапазоном, и каждый релиз является уникальным сочетание имени и версии, мы можем обнаружить совместимые версии программно, используя команду <code>npm outdated</code>.</p><p>Команда <code>npm update</code> обновит все ваши пакеты до максимальной версии, которая разрешена в <code>package.json</code>.</p><p>Итого, мы научились выполнять скрипты прямо в консоли с помощью <code>Node.js</code>, создавать <code>package.json</code>, узнали как писать и исполнять базовые <code>npm скрипты</code>, устанавливать <code>npm пакеты</code>. Используя эти знания мы можем уверенно приступать к настройке сборки <code>Gulp</code>.</p><p><a href="https://blog.risingstack.com/nodejs-at-scale-npm-best-practices/" target="_blank"><strong>npm Best Practices</strong></a></p></section><section><h2 id="gulp">Gulp</h2><p>Раньше, веб разработка была довольно простой задачей: создавался какой-то CSS и HTML, и возможно, подключались одни или два JavaScript файла к веб-сайту. Сегодня веб-разработка значительно усложнилась, создаютсяы большие, оптимизированые, кроссбраузерные веб-сайты и веб-приложения.</p><p>Чтобы справиться с этой сложностью, мы можем использовать инструмент автоматизации рабочего процесса, который работает как конвейер, выполняя рутинные задачи за нас. Компьютеры очень хороши, когда им дают список вещей, которые нужно сделать, и выполнять их абсолютно одинаково каждый раз.</p><p><strong>Gulp</strong> - это инструмент, который помогает автоматизировать рутинные задачи веб-разработки. Он предназначен для решения таких задач, как:</p><ul><li>Создание веб-сервера и автоматическая перезагрузка страницы в браузере при сохранении кода.</li><li>Слежение за изменениями в файлах проекта.</li><li>Использование различных JavaScript, CSS и HTML препроцессоров.</li><li>Минификация CSS и JS кода, а также, оптимизация и конкатенация отдельных файлов проекта в один.</li><li>Автоматическое создание вендорных префиксов для CSS.</li><li>Управление файлами и папками в рамках проекта - создание, удаление, переименование.</li><li>Работа с изображениями - сжатие, создание спрайтов.</li></ul><p>Можно с уверенностью сказать, что Gulp и множество утилит, написанных для него, подходят для решения практически любой задачи при разработке проекта любой сложности - от небольшого сайта до крупного проекта.</p><h3>Установка и использование</h3><p>Любой проект, использующий <strong>Gulp</strong> имеет в корне файл <code>gulpfile.js</code>, который содержит набор инструкций для управления проектом.</p><p>Написание инструкций для <strong>Gulp</strong> не является программированием, хотя они пишутся на JavaScript. Не стоит пугаться больших <code>gulpfile.js</code>, в основном все инструкции однотипные, следуют одним правилам и имеют общие черты.</p><p>Когда мы создали наш пустой проект и выполнили <code>npm init</code>, мы готовы использовать <strong>Gulp</strong>. Это npm-пакет, первое что мы сделаем это установим его. Будем ставить локально, как зависимость разработки.</p><pre class=" language-javascript"><code class=" language-javascript">npm install gulp <span class="token operator">--</span>save<span class="token operator">-</span>dev</code></pre><p>В <code>gulpfile.js</code> сделаем импорт модуля. Оператор <code>require</code> указывает Node просмотреть папку <code>node_modules</code> на наличие пакета с именем <code>gulp</code>. Как только пакет будет найден, его содержимое будет присвоено в переменную <code>gulp</code>.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword keyword-const">const</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Теперь в переменной <code>gulp</code> будет объект с методами. На самом деле, если вы заглянете в исходный код npm модуля, можно увидеть что возвращается экземпляр функции-конструктора <code>Gulp</code>, тоесть объект с методами.</p><h4>gulp.task</h4><p><code>task</code> - наверное основной метод <strong>Gulp</strong>, создает задачу которую можно будет выполнить через npm-скрипт или нарямую через <strong>Gulp</strong>, если он установлен глобально.</p><p>В самом простом варианте, gulp-задача выглядит следующим образом:</p><pre class=" language-javascript"><code class=" language-javascript">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'task-name'</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Первый аргумент <code>task-name</code> указывает имя задачи по которому мы будем обращаться всякий раз, когда захотим запустить задачу на выполнение. Вторым аргументом передаем callback-функцию которая будет исполнена при обращении к задаче.</p><p>"Полноценная" задача использует как минимум два дополнительных метода gulp:</p><ul><li><code>gulp.src</code> - сообщает задаче, какие файлы использовать.</li><li><code>gulp.dest</code> - указывает куда вывести файлы после завершения задачи.</li></ul><pre class=" language-javascript"><code class=" language-javascript">gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'task-name'</span><span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-return">return</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">'source-files'</span><span class="token punctuation">)</span> <span class="token comment">// Взять файлы с помощью gulp.src</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">aGulpPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Пропустить их через gulp-плагин</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">'destination folder'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Положить результат в указаную папку</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4>pipe()</h4><p>NodeJS использует собственные объекты и методы для работы с данными, в том числе с файлами. Мы уже знаем что <code>gulpfile.js</code> можно запустить на выполнение в Node-среде. Метод <code>pipe</code> принадлежит самому Node.js.</p><p>Для дальнейшего пониманния работы Node важно усвоить, что gulp-таск берет данные указаные в <code>src,</code> после чего используя <code>pipe(gulp-плагин)</code> вызывает gulp-плагины на этих данных, последовательно, в указаном порядке, после чего записывает результат в путь указаный <code>gulp.dest</code>.</p><p>Не вдаваясь в детали рассмотрим пример, как в <strong>NodeJS</strong> с помощью этого метода читают содержимое файла, сжимают его и записывают результат.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword keyword-const">const</span> r <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'file.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> z <span class="token operator">=</span> zlib<span class="token punctuation">.</span><span class="token function">createGzip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> w <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'file.txt.gz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

r<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>То есть метод <code>pipe</code> берет результат выполнения предущего шага и передает его в плагин переданный ему в виде аргумента. Это те же самые цепочки вызовов, как у методов массива <code>arr.map().filter()</code>, общая идея такая же.</p><h3>Пример</h3><ul><li>Используем наш node-project</li><li>Удалим пакет <code>uuid</code> так как он нам не нужен</li><li>Поставим <strong>Gulp</strong> как зависимость разработки</li><li>Напишем таск с именем <code>gulpTask</code> и в callback-функции сделаем <code>console.log</code></li><li>Модифицируем наш npm-скрипт start: <code>"start": "gulp gulpTask"</code></li><li>В консоли запустим <code>npm start</code></li></ul><img src="./Module 12_files/gulp-test.png" alt="gulp task"><ul><li><a href="https://tproger.ru/translations/npm-tricks/" target="_blank" rel="noopener">Упрощаем работу с npm: полезные сокращения и трюки</a></li><li><a href="https://youtu.be/vW51JUVT66w" target="_blank">Gulp для самых маленьких - подробное руководство</a></li><li><a href="https://css-tricks.com/gulp-for-beginners/" target="_blank">Gulp for Beginners</a></li><li><a href="https://github.com/axZerk/gulp-starter-kit" target="_blank">Базовая Gulp-сборка</a></li></ul></section></article><a href="http://fecore.net.ua/javascript/pages/theory/module-12-1.html#main-nav" class="to-page-nav"></a></div></body></html>