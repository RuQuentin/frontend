<!DOCTYPE html>
<!-- saved from url=(0061)http://fecore.net.ua/javascript/pages/theory/module-10-1.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>Module 10</title><link rel="stylesheet" href="./Module 10_files/styles.min.css"><script async="" src="./Module 10_files/ei.js.Без названия"></script><script async="" src="./Module 10_files/scripts.min.js.Без названия"></script></head><body class="theory-page"><div class="wrapper"><article><header><nav class="table-of-contents" id="main-nav"><ol class="page-nav" id="page-nav"><li><a href="http://fecore.net.ua/javascript/pages/theory/module-10-1.html#protocols">Протоколы передачи данных</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-10-1.html#rest">REST</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-10-1.html#json">JSON</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-10-1.html#ajax">AJAX</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-10-1.html#fetch">Fetch API</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-10-1.html#crud">CRUD</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-10-1.html#web-api">Работа с Web API</a></li><li><a href="http://fecore.net.ua/javascript/pages/theory/module-10-1.html#cors">Кросс-доменные запросы</a></li></ol></nav></header><section><h2 id="protocols">Протоколы передачи данных</h2><p>Перед тем как пользователь увидит содержимое сайта у себя на экране, браузер делает запрос на сервер чтобы получить это самое содержимое. Это влияет на скорость отображения веб-страниц, поэтому необходимо как минимум представлять как эти данные бразуер получает.</p><p><strong>Протокол</strong> — это набор правил и соглашений, используемых при передаче данных.</p><p><strong>TCP/IP</strong> - основополагающий протокол сети Internet. Это два различных протокола, тесно связанных между собой.</p><p><strong>TCP (Transmission Control Protocol)</strong> - протокол управления передачей. Он определяет, каким образом информация должна быть разбита на пакеты и отправлена по каналам связи. TCP располагает пакеты в нужном порядке, а также проверяет каждый пакет на наличие ошибок при передаче.</p><p><strong>IP (Internet Protocol)</strong> – каждый информационный пакет содержит IP-адреса компьютера-отправителя и компьютера-получателя. Специальные компьютеры, называемые маршрутизаторами, используя IP-адреса, направляют информационные пакеты в нужную сторону, то есть к указанному в них получателю.</p><p>Первое что нужно запомнить — браузер запрашивает и получает данные посредством HTTP-протокола, поэтому его (браузер) еще называют HTTP-клиентом.</p><h3>HyperText Transfer Protocol (HTTP)</h3><p><strong>Протокол передачи Гипертекста (HTTP)</strong> — специально разработанный протокол как основа World Wide Web, используется для передачи всех необходимых данных: HTML, изображений, CSS, JavaScript и т.д. Дефолтный TCP-порт - <strong>80</strong>.</p><p>HTTP основан на модели клиент-сервер и протоколе запроса/ответа, который работает путем обмена сообщениями через надежное TCP/IP соединение.</p><img src="./Module 10_files/http-protocol.png" alt="http protocols"><p>Есть клиент, который инициирует соединение и посылает запрос, и сервер, который ожидает соединения для получения запроса, производит необходимые действия и возвращает обратно сообщение с результатом. Связь между ними осуществляется посредством череды перемежающихся HTTP-запросов и HTTP-ответов.</p><ul><li><a href="http://infocisco.ru/network_model_osi.html" target="_blank">Сетевая модель</a></li><li><a href="https://www.tutorialspoint.com/http/index.htm" target="_blank">Руководство по HTTP</a></li></ul><h3>HyperText Transfer Protocol Secure (HTTPS)</h3><p><strong>HTTPS</strong> — расширение протокола HTTP, для поддержки шифрования в целях повышения безопасности. Данные в протоколе HTTPS передаются поверх криптографических протоколов SSL или TLS. Дефолтный TCP-порт - 443.</p><p>Он обеспечивает защиту от атак, основанных на прослушивании сетевого соединения, при условии что будут использоваться шифрующие средства и сертификат сервера проверен и ему доверяют.</p><ul><li>Информация о клиенте, например номера кредитных карт, зашифрована и не может быть перехвачена</li><li>Посетители могут подтвердить, что вы зарегистрированный бизнес и что у вас есть домен</li><li>Клиенты с большей вероятностью будут доверять и совершать покупки с сайтов, использующих HTTPS</li></ul><img src="./Module 10_files/http-https.png" alt="http https protocols"><h3>На что тратит время HTTP запрос</h3><p>Запрос происходит в несколько этапов:</p><ul><li><strong>DNS-запрос</strong> — поиск ближайшего DNS-сервера, чтобы преобразовать адрес (например google.com ) в его числовое представление — IP-адрес (74.125.87.99).</li><li><strong>Соединение</strong> — установка соединения с сервером по полученному IP-адресу.</li><li><strong>Отправка данных</strong> - пересылка пакетов с клиента на сервер.</li><li><strong>Ожидание ответа</strong> — ждем пока пакеты данных дойдут до сервера, он их обработает и ответ вернется назад.</li><li><strong>Получение данных</strong> - пакеты пришли, можно получать из них данные.</li></ul></section><section><h2 id="rest">REST</h2><p><strong>API (интерфейс прикладного программирования)</strong> — набор четко определенных способов связи между различными программными компонентами. API описывает что можно попросить программу сделать и что получить в результате.</p><p><strong>Сервер</strong> — это программа, расположенная на компъютре настроеном на обработку запросов, способная получить запрос на определенный адрес и имеющая набор готовых действий на определенные запросы.</p><p><strong>REST (Representational state transfer)</strong> — представляет собой стиль архитектуры, основанный на наборе принципов, которые описывают как сетевые ресурсы определяются и адресуются.</p><p><strong>RESTful API</strong> — работает как веб-сайт, мы посылаем запрос с клиента на сервер, но в ответ получаем запрошенные данные.</p><ul><li><a href="https://www.youtube.com/watch?v=YCcAE2SCQ6k" target="_blank">Intro to REST</a></li><li><a href="https://www.youtube.com/watch?time_continue=10&amp;v=llpr5924N7E" target="_blank">Intro to REST (aka. What Is REST Anyway?)</a></li><li><a href="https://www.sitepoint.com/developers-rest-api/" target="_blank">Do you know what a REST API is?</a></li></ul><h3>Формат запроса</h3><p>REST-сервис требует, чтобы клиент делал запрос на добавление, извлечение или изменение данных на сервере. Запрос обычно состоит из:</p><ul><li><strong>HTTP-метод</strong> — определяет какую операцию выполнять</li><li><strong>Заголовок</strong> — позволяет клиенту передавать информацию о запросе</li><li><strong>Путь</strong> — путь к ресурсу. Доступные пути описываются в документации REST-сервиса</li><li><strong>Тело</strong> — дополнительный блок запроса, содержащий данные</li></ul><h4>HTTP-методы</h4><p>Выделяют 4 основных метода для работы с REST-сервисом.</p><ul><li><strong>POST</strong> — создать новый ресурс</li><li><strong>GET</strong> — получить набор ресурсов или определенный ресурс по идентификатору</li><li><strong>PUT</strong> — обновление определенного ресурса по идентификатору</li><li><strong>DELETE</strong> — удаление определенного ресурса по идентификатору</li></ul><h4>Заголовки</h4><p>В заголовках запроса клиент отправляет дополнительные опции. К примеру тип контента который он может обработать (заголовок <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept" target="_blank" rel="noopener">Accept</a>) или который описывает тип ресурса который клиент ожидает в ответе от REST-сервиса (заголовок <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type" target="_blank" rel="noopener">Content-Type</a>). Это гарантирует, что сервер не отправляет данные, которые не могут быть обработаны клиентом.</p><p>Варианты типов контента - это MIME-типы (Multipurpose Internet Mail Extensions). Больше о них вы можете почитать в <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank" rel="noopener">MDN-документации</a>.</p><p>MIME-типы, используемые для указания содержимого, состоят из типа и подтипа, которые разделены косой чертой <code>/</code>.</p><p>Например, текстовый файл, содержащий HTML, будет описан типом <code>text/html</code>. Если файл содержит CSS, он будет описан как <code>text/css</code>. Просто текстовый файл будет описан как <code>text/plain</code>. Если, к примеру, клиент ожидает <code>text/css</code>, а получает <code>text/plain</code>, он не сможет распознать и обработать контент.</p><p>Другие часто использующиеся MIME-типы для групп контента:</p><ul><li>Изображение — <code>image/png</code>, <code>image/jpeg</code>, <code>image/gif</code></li><li>Аудио — <code>audio/wav</code>, <code>audio/mpeg</code></li><li>Видео — <code>video/mp4</code>, <code>video/ogg</code></li><li>Ресурсы — <code>application/json</code>, <code>application/pdf</code>, <code>application/xml</code></li></ul><h4>Пути</h4><p>Запросы должны содержать путь к ресурсу, над которым должна выполняться операция. Доступные пути описываются при создании REST-сервиса в его документации.</p><pre class=" language-javascript"><code class=" language-javascript">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>bookstore<span class="token punctuation">.</span>com<span class="token operator">/</span>customers<span class="token operator">/</span><span class="token number">289</span><span class="token operator">/</span>orders<span class="token operator">/</span><span class="token number">12</span></code></pre><p>Такой путь явно указывает ресурс, даже если вы никогда раньше не видели его, потому что он является иерархическим и описательным. Мы обращаемся к заказу с идентификатором <code>12</code> для клиента с идентификатором <code>289</code>.</p><h4>Коды ответов</h4><p>На запрос клиента сервер отправляет ответ. Ответ содержит коды состояния, чтобы информировать клиента о результате операции. Вам не нужно знать каждый код состояния (их много), но вы должны знать наиболее распространенные и их значение.</p><table><tbody><tr><th>Status code</th><th>Значение</th></tr><tr><td><strong>200 (OK)</strong></td><td>Это стандартный ответ для успешных HTTP-запросов</td></tr><tr><td><strong>201 (CREATED)</strong></td><td>Это стандартный ответ для HTTP-запроса, который привел к успешному созданию ресурса</td></tr><tr><td><strong>400 (BAD REQUEST)</strong></td><td>Запрос не может быть обработан из-за неверного синтаксиса запроса или другой ошибки клиента.</td></tr><tr><td><strong>401 (UNAUTHORIZED)</strong></td><td>Для доступа к ресурсу требуется авторизация.</td></tr><tr><td><strong>403 (FORBIDDEN)</strong></td><td>У клиента нет разрешения на доступ к этому ресурсу.</td></tr><tr><td><strong>404 (NOT FOUND)</strong></td><td>В настоящее время ресурс не найден. Возможно, он был удален или еще не существует.</td></tr><tr><td><strong>500 (INTERNAL SERVER ERROR)</strong></td><td>Общий ответ на непредвиденный сбой, если нет более конкретной информации.</td></tr></tbody></table><h4>Запрос-Ответ</h4><p>Предположим, у нас есть приложение, которое позволяет просматривать, создавать, редактировать и удалять клиентов и заказы небольшого книжного магазина, размещенного на <code>bookstore.com</code>.</p><p>Используя полученные знания мы можем, псевдокодом, описать цикл запрос-ответ к REST-сервису.</p><p>Если бы мы хотели просмотреть всех клиентов, запрос будет выглядеть так:</p><pre class=" language-javascript"><code class=" language-javascript">GET http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>bookstore<span class="token punctuation">.</span>com<span class="token operator">/</span>customers
Accept<span class="token punctuation">:</span> application<span class="token operator">/</span>json</code></pre><p>Тогда заголовок ответа будет выглядеть так:</p><pre class=" language-javascript"><code class=" language-javascript">Status Code<span class="token punctuation">:</span> <span class="token number">200</span> <span class="token punctuation">(</span>OK<span class="token punctuation">)</span>
Content<span class="token operator">-</span>type<span class="token punctuation">:</span> application<span class="token operator">/</span>json</code></pre><p>Для просмотра одного клиента мы указываем его идентификатор:</p><pre class=" language-javascript"><code class=" language-javascript">GET http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>bookstore<span class="token punctuation">.</span>com<span class="token operator">/</span>customers<span class="token operator">/</span><span class="token number">123</span>
Accept<span class="token punctuation">:</span> application<span class="token operator">/</span>json</code></pre><p>Тогда заголовок ответа будет выглядеть так:</p><pre class=" language-javascript"><code class=" language-javascript">Status Code<span class="token punctuation">:</span> <span class="token number">200</span> <span class="token punctuation">(</span>OK<span class="token punctuation">)</span>
Content<span class="token operator">-</span>type<span class="token punctuation">:</span> application<span class="token operator">/</span>json</code></pre><p>Создание нового клиента:</p><pre class=" language-javascript"><code class=" language-javascript">POST http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>bookstore<span class="token punctuation">.</span>com<span class="token operator">/</span>customers
Body<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">"customer"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Mango"</span>
    <span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"mango@gmail.com"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Затем сервер генерирует идентификатор для этого объекта и возвращает его обратно клиенту с заголовком, например:</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token number">201</span> <span class="token punctuation">(</span>CREATED<span class="token punctuation">)</span>
Content<span class="token operator">-</span>type<span class="token punctuation">:</span> application<span class="token operator">/</span>json</code></pre></section><section><h2 id="json">JSON</h2><p><a href="http://www.json.org/index.html" target="_blank"><strong>JSON</strong> </a>- представляет собой формат данных, предназначенный для хранения и передачи данных. Самый популярный формат на сегодняшний день. Его объектоподобный синтаксис очень удобен для описания данных.</p><p>JSON можно рассматривать как строковое представление JavaScript-объекта. Поддерживает следующие значения: <strong>string</strong>, <strong>number</strong>, <strong>object</strong>, <strong>array</strong>, <strong>boolean</strong>, <strong>null</strong>.</p><p>Ниже приведен пример JSON-файла. Он очень похож на объекты, за исключением того, что ключи и все кроме: <strong>чисел</strong>, <strong>булей</strong>, <strong>null</strong>, <strong>литерала массива и объекта</strong>, всегда должны быть в двойных кавычках.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token punctuation">{</span>
  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"Josh"</span><span class="token punctuation">,</span>
  <span class="token string">"weight"</span><span class="token punctuation">:</span> <span class="token number">175</span><span class="token punctuation">,</span>
  <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
  <span class="token string">"eyecolor"</span><span class="token punctuation">:</span> <span class="token string">"brown"</span><span class="token punctuation">,</span>
  <span class="token string">"isHappy"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">"cars"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"Chevy"</span><span class="token punctuation">,</span> <span class="token string">"Honda"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"favoriteBook"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"When the Fire Nation Attacked"</span><span class="token punctuation">,</span>
    <span class="token string">"author"</span><span class="token punctuation">:</span> <span class="token string">"Nickelodeon"</span><span class="token punctuation">,</span>
    <span class="token string">"released"</span><span class="token punctuation">:</span> <span class="token string">"02-21-2005"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><p>Javascript и JSON отлично работают вместе благодаря методам <code>JSON.stringify()</code> и <code>JSON.parse()</code>. Они преобразуют объект JS-объект в JSON и обратно, поэтому независимо от того, что у вас есть, можно легко получить обратное.</p><h3>JSON.stringify()</h3><p>Чтобы использовать <code>stringify</code>, просто передайте объект JavaScript, который вы хотите преобразовать в JSON.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword keyword-const">const</span> dog <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">"Mango"</span><span class="token punctuation">,</span>
  age<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  isHappy<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> dogJSON <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dogJSON<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {"name":"Mango","age":3,"isHappy":true}</span></code></pre><p><code>JSON.stringify(dog)</code> взял объект <code>dog</code> и преобразовал его в строку. Эта строка теперь валидный JSON и может быть сохранена в файл или передана по сети.</p><h3>JSON.parse()</h3><p>Чтобы получить объект JavaScript из JSON, вы должны разобрать (распарсить) его, операция обратная <code>stringify</code>.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword keyword-const">const</span> json <span class="token operator">=</span> <span class="token string">'{"name":"Mango","age":3,"isHappy":true}'</span><span class="token punctuation">;</span>

<span class="token keyword keyword-const">const</span> dog <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dog<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {name: "Mango", age: 3, isHappy: true}</span></code></pre><p>Теперь, когда <code>dog</code> является обычным объектом JavaScript, вы можете его использовать.</p></section><section><h2 id="ajax">AJAX</h2><p><strong>Асинхронный код</strong> - это код, который работает независимо от основного, поэтому в нем можно запрашивать или отправлять данные, не замораживая страницу для пользователя.</p><p><strong>AJAX (Asynchronous JavaScript and XML)</strong> - это метод отправки или запроса данных без необходимости перезагрузки страницы. За счет этого уменьшается время отклика и веб-страница получается более интерактивная и живая.</p><p>Несмотря на то, что в названии технологии присутствует буква X (от слова XML), использовать XML вовсе не обязательно. Под AJAX подразумевают любое общение с сервером без перезагрузки страницы.</p><h3>Область применения</h3><p><strong>Элементы интерфейса</strong> - AJAX полезен для форм и кнопок, связанных с элементарными действиями: добавить в корзину, подписаться, и т.п. Сейчас – в порядке вещей, что такие действия на сайтах осуществляются без перезагрузки страницы.</p><p><strong>Динамическая подгрузка данных</strong> - например галлерея карточек товаров с кнопкой "Показать больше".</p><p><strong>Живой поиск</strong> - классический пример использования AJAX, взятый на вооружение современными поисковыми системами. Пользователь начинает печатать поисковую фразу, а JavaScript предлагает возможные варианты, получая список самых вероятных дополнений с сервера.</p></section><section><h2 id="fetch">Fetch API</h2><p><a href="https://goo.gl/w17gH3" target="_blank"><strong>Fetch API</strong> </a>— предоставляет интерфейс, набор методов и объектов запроса и ответа, для получения ресурсов от сервера.</p><p><code>window.fetch()</code> — это <a href="http://fecore.net.ua/javascript/pages/theory/module-10-1.html#xhr">XMLHttpRequest</a> нового поколения. Он предоставляет улучшенный интерфейс для составления запросов к серверу. Построен на обещаниях.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> options<span class="token punctuation">)</span></code></pre><ul><li><code>url</code> — обязательный, путь к данным которые вы хотите получить.</li><li><code>options</code> — необязатльнный, объект настроек запроса. Содержит служебную информацию: метод, заголовки и т.д.</li></ul><p>Возвращает промис, который содержит ответ сервера.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"https://test-website.name/some/url"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//response handling</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// data handling</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword keyword-catch">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3>Response</h3><p><a href="https://goo.gl/8b7UVc" target="_blank"><strong>Response</strong> </a>— в первый <code>then</code> после вызова <code>fetch</code> передается экземпляр класса <strong>Response</strong>, который снабжает екземпляр различными методами и свойствами. В нем содержится служебная информация о состоянии ответа сервера.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">"https://test-website.name/some/url"</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-if">if</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token keyword keyword-return">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-throw">throw</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Error while fetching: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>response<span class="token punctuation">.</span>statusText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// data handling</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword keyword-catch">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// error handling</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3>Headers</h3><p><a href="https://goo.gl/W2KopN" target="_blank"><strong>Headers</strong> </a>— позволяет выполнять различные действия в заголовках HTTP-запроса и ответа. Эти действия включают в себя извлечение, настройку, добавление и удаление заголовков (методы <code>append</code>, <code>has</code>, <code>get</code>, <code>set</code>, <code>delete</code>).</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword keyword-const">const</span> headers <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

headers<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/plain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"X-Custom-Header"</span><span class="token punctuation">,</span> <span class="token string">"custom value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
headers<span class="token punctuation">.</span><span class="token keyword keyword-get">get</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "text/plain"</span>
headers<span class="token punctuation">.</span><span class="token keyword keyword-set">set</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
headers<span class="token punctuation">.</span><span class="token keyword keyword-delete">delete</span><span class="token punctuation">(</span><span class="token string">"X-Custom-Header"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Для составления заголовков запроса, если необходимы методы заголовков, можно использовать объект настроек при вызове <code>new Headers</code>, с парами <code>ключ:значение</code>.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword keyword-const">const</span> headers <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token string">'X-Custom-Header'</span><span class="token punctuation">:</span> <span class="token string">'custom value'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Или просто литера объекта со свойствами, но в таком случае методов заголовков не будет, что зачастую и не требуется :)</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword keyword-const">const</span> headers <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
  <span class="token string">'X-Custom-Header'</span><span class="token punctuation">:</span> <span class="token string">'custom value'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre><p>Запрос с использованием заголовков может выглядеть так.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'my-cool-website.net/data'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token string">'X-Custom-Header'</span><span class="token punctuation">:</span> <span class="token string">'custom value'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3>Использование</h3><p>Рассмотрим пример запроса.</p><div class="cp_embed_wrapper"><iframe id="cp_embed_gGaaqg" src="./Module 10_files/gGaaqg.html" scrolling="no" frameborder="0" height="400" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" name="CodePen Embed" title="module-11-simple-fetch" class="cp_embed_iframe " style="width: 100%; overflow: hidden;"></iframe></div><h3>Ошибка при работе с асинхронным кодом</h3><p>Разберем распространенную ошибку начинающих разработчиков, попытку использовать данные вне метода <code>then</code>, используем для этого предыдущий пример.</p><div class="cp_embed_wrapper"><iframe id="cp_embed_veOrOa" src="./Module 10_files/veOrOa.html" scrolling="no" frameborder="0" height="400" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" name="CodePen Embed" title="module-11-async-call-mistake" class="cp_embed_iframe " style="width: 100%; overflow: hidden;"></iframe></div></section><section><h2 id="crud">CRUD</h2><p>Создание (create), чтение (read), обновление (update) и удаление (delete) — это четыре основные метода для взимодействия с ресурсами API.</p><p>В REST-среде, CRUD соответствует HTTP-методам:.</p><ul><li><strong>POST (create)</strong> — создать новый ресурс</li><li><strong>GET (read)</strong> — получить набор ресурсов или определенный ресурс по идентификатору</li><li><strong>PUT (update)</strong> — обновление определенного ресурса по идентификатору</li><li><strong>DELETE (delete)</strong> — удаление определенного ресурса по идентификатору</li></ul><p>Допустим наш API хранит массив постов, каждый из которых это объект со следующими полями.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token string">"post"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>Integer<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token string">"author"</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token string">"body"</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre><h3>Создание (create, POST)</h3><p>Происходит когда мы хотим добавить новый пост. Функция которая будет это делать, должна отправить на сервер запрос, в теле которого будет объект с полями <code>author</code> и <code>body</code>. RESTful API по получению запроса добавит объекту <code>id</code> и в ответе на запрос вернет этот ресурс.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword keyword-const">const</span> newPost <span class="token operator">=</span> <span class="token punctuation">{</span>
  author<span class="token punctuation">:</span> <span class="token string">'Mango'</span><span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> <span class="token string">'CRUD is awesome'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://jsonplaceholder.typicode.com/posts'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    body<span class="token punctuation">:</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>newPost<span class="token punctuation">)</span><span class="token punctuation">,</span>
    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"Content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/json; charset=UTF-8"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword keyword-catch">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ERROR'</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* В ответ, если все хорошо, получим объект с добавленным id
  {
    id: 1, // идентификатор будет уникальным для каждого поста
    author: 'Mango',
    body: 'CRUD is awesome',
  }
*/</span></code></pre><h3>Чтение (read, GET)</h3><p>Происходит когда мы хотим получить существующие данные. Функция которая будет это делать, должна отправить на сервер запрос, без тела. RESTful API по получению запроса обработает его и в ответе на запрос вернет необходимые ресусрсы.</p><p>Просим все посты.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://jsonplaceholder.typicode.com/posts'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword keyword-catch">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Просим один пост по <code>id</code>, к примеру пост с <code>id = 1</code>.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://jsonplaceholder.typicode.com/posts/1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword keyword-catch">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3>Обновление (update, PUT)</h3><p>Происходит когда мы хотим обновить существующие данные. Функция которая будет это делать, должна отправить на сервер запрос, в теле которого необходимо указать объект с полями для изменения. RESTful API по получению запроса обработает его и в ответе на запрос вернет обновленный ресурс.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token keyword keyword-const">const</span> postToUpdate <span class="token operator">=</span> <span class="token punctuation">{</span>
  body<span class="token punctuation">:</span> <span class="token string">'CRUD is realy awesome'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://jsonplaceholder.typicode.com/posts/1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">'PUT'</span><span class="token punctuation">,</span>
    body<span class="token punctuation">:</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>postToUpdate<span class="token punctuation">)</span><span class="token punctuation">,</span>
    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">"Content-type"</span><span class="token punctuation">:</span> <span class="token string">"application/json; charset=UTF-8"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword keyword-catch">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ERROR'</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* В ответ, если все хорошо, получим обновленный объект
  {
    id: 1, // идентификатор будет уникальным для каждого поста
    author: 'Mango',
    body: 'CRUD is realy awesome',
  }
*/</span></code></pre><h3>Удаление (delete, DELETE)</h3><p>Происходит когда мы хотим удалить существующие данные. Функция которая будет это делать, должна отправить на сервер запрос, без тела. RESTful API по получению запроса обработает его, удалит ресурс из коллекции, и в ответе на запрос вернет статус результата.</p><pre class=" language-javascript"><code class=" language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://jsonplaceholder.typicode.com/posts/1'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token punctuation">:</span> <span class="token string">'DELETE'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token keyword keyword-catch">catch</span><span class="token punctuation">(</span>error <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ERROR'</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></section><section><h2 id="web-api">Работа с Web API</h2><p>Каждый API уникален (их тысячи), невозможно заучить "код" для работы с одним API и использовать его для общения с другим. Можно понять принцип и методы работы, после чего, все что нужно сделать, это ознакомиться с документацией того сервиса который необходимо использовать.</p><p>Для примера был выбран API ПриватБанка <a href="https://api.privatbank.ua/" target="_blank"><code>api.privatbank.ua</code></a></p><h3>Получаем курс валют</h3><p>URL API ПриватБанка для получения ответа о текущем курсе обмена.</p><p><a href="https://api.privatbank.ua/#p24/exchange" target="_blank">Документация о запросах на курс валют.</a></p><pre class=" language-javascript"><code class=" language-javascript">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>api<span class="token punctuation">.</span>privatbank<span class="token punctuation">.</span>ua<span class="token operator">/</span>p24api<span class="token operator">/</span>pubinfo<span class="token operator">?</span>exchange<span class="token operator">&amp;</span>json<span class="token operator">&amp;</span>coursid<span class="token operator">=</span><span class="token number">11</span></code></pre><p>Состоит из:</p><ul><li><strong>https://api.privatbank.ua</strong> - endpoint, server, base URL, host. Точка входа на сервер.</li><li><strong>p24api/pubinfo</strong> - ресурс к которому мы обращаемся</li><li><strong>?</strong> - говорит о том что после идут параметры запроса</li><li><strong>&amp;</strong> - используется для указания смыслового 'и', он связывает множественные параметры запроса</li></ul><p>Параметры ответа из документации:</p><table><tbody><tr><th>Название</th><th>Описание</th></tr><tr><td><code>ccy</code></td><td>Код валюты (справочник кодов валют: https://ru.wikipedia.org/wiki/Коды_валют)</td></tr><tr><td><code>base_ccy</code></td><td>Код национальной валюты</td></tr><tr><td><code>buy</code></td><td>Курс покупки</td></tr><tr><td><code>sale</code></td><td>Курс продажи</td></tr></tbody></table><div class="cp_embed_wrapper"><iframe id="cp_embed_JrYGVE" src="./Module 10_files/JrYGVE.html" scrolling="no" frameborder="0" height="500" allowtransparency="true" allowfullscreen="true" allowpaymentrequest="true" name="CodePen Embed" title="module-11-privat-api" class="cp_embed_iframe " style="width: 100%; overflow: hidden;"></iframe></div></section><section><h2 id="cors">Кросс-доменные запросы</h2><p>Обычно запрос можно делать запрос только в рамках текущего сайта. При попытке использовать другой домен/порт/протокол – браузер выдаёт ошибку. Так вы можете получить ошибку при попытке сделать fetch-запрос с <strong>http</strong> протокла на API с <strong>https</strong> протоколом.</p><ul><li><a href="https://youtu.be/stvCHJZq5MI" target="_blank" rel="noopener">cors, json, jsonp</a></li><li><a href="https://livebook.manning.com/#!/book/cors-in-action/chapter-1/1" target="_blank">The Core of CORS</a></li><li><a href="https://www.html5rocks.com/en/tutorials/cors/" target="_blank" rel="noopener">Большая статья по CORS</a></li></ul></section></article><a href="http://fecore.net.ua/javascript/pages/theory/module-10-1.html#main-nav" class="to-page-nav"></a></div></body></html>